"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[7777],{7777:(Jt,H,s)=>{s.r(H),s.d(H,{POSModule:()=>T});var m=s(6895),pe=s(8277),E=s(148),g=s(6325),I=s(7084),A=s(7392),D=s(4393),M=s(9818),de=s(74),h=s(8455),O=s(9203),V=s(1256),Q=s(8256),F=s(5208),ue=s(2793),me=s(5754),J=s(7462),he=s(3267),fe=s(4080),ge=s(445),e=s(4650);let _e=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[ge.vT]}),n})();var N=s(3238),L=s(7579);s(7340);let q=(()=>{class n{constructor(){this.changes=new L.x,this.optionalLabel="Optional",this.completedLabel="Completed",this.editableLabel="Editable"}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ze={provide:q,deps:[[new e.FiY,new e.tp0,q]],useFactory:function Me(n){return n||new q}};let ke=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[Ze,N.rD],imports:[N.BQ,m.ez,fe.eL,_e,A.Ps,N.si,N.BQ]}),n})();var x=s(9132),G=s(7775),Ee=s(4953),Oe=s(79),Ne=s(459),Re=s(6879),l=s(4006),B=s(1135),Ue=s(9751),W=s(655);class R{}class X{constructor(t=1024){this.buffer=new Uint8Array(t),this.size=0}clear(){this.size=0}flush(){const t=new Uint8Array(this.buffer.slice(0,this.size));return this.size=0,t}write(t){return this.resize(t.length),this.buffer.set(t,this.size),this.size+=t.length,this}writeUInt8(t){return this.resize(1),this.buffer[this.size++]=255&t,this}resize(t){const i=this.buffer.length-this.size;if(i<t){const r=this.buffer,o=Math.ceil((t-i)/r.length)+1;this.buffer=new Uint8Array(r.length*o),this.buffer.set(r,0)}}}const _=27;class Qe extends R{constructor(){super(),this.encoder=new TextEncoder}init(){return this.buffer=new X,this.write(_),this.write("@"),this}flush(){return this.buffer.flush()}feed(t=1){return this.write(_),this.write("a"),this.write(t),this}cut(t="full"){return this.write(_),this.write("d"),this.write("full"===t?2:3),this}writeLine(t){return this.write(`${t}\n`)}setInverse(t=!0){return this.write(_),this.write(t?"4":"5"),this}setUnderline(t=!0){return this.write(_),this.write("-"),this.write(t?1:0),this}setJustification(t){let i;switch(t){case"center":i=1;break;case"right":i=2;break;default:i=0}return this.write(_),this.write(29),this.write("a"),this.write(i),this}setBold(t=!0){return this.write(_),this.write(t?"E":"F"),this}setSize(t){return this.write(_),this.write("i"),this.write("normal"===t?0:1),this.write("normal"===t?0:1),this}write(t){return"number"==typeof t?this.buffer.writeUInt8(t):this.buffer.write("string"==typeof t?this.encoder.encode(t):t),this}}var p=function(){};p.prototype.createAlignmentElement=function(n){var t="<alignment";return null!=n&&(t+=this._analysisEnumAttribute("position",n.position,/^(left|center|right)$/)),t+"/>"},p.prototype.createBarcodeElement=function(n){var t;if(null==n)throw Error("Argument is undefined.");if(t="<barcode"+this._analysisEnumAttribute("symbology",n.symbology,/^(UPCE|UPCA|JAN8|JAN13|Code39|ITF|Code128|Code93|NW7)$/),t+=this._analysisEnumAttribute("width",n.width,/^(width[2-4]|width_mode[1-9])$/),t+=this._analysisEnumAttribute("hri",n.hri,/^(false|true)$/),t+=this._analysisValueAttribute("height",n.height,1,255),null==n.data)throw Error('Argument "data" is undefined.');return(t=t+">"+this._encodeEscapeSequenceBinary(n.data))+"</barcode>"},p.prototype.createBitImageElement=function(n){var t="<bitimage";if(null==n)throw Error("Argument is undefined.");var i=0,r=0,o=0,a=0;if(null!=n.x&&(i=n.x),null!=n.y&&(r=n.y),null!=n.width&&(o=n.width),null!=n.height&&(a=n.height),this._analysisValueAttribute("x",i,0,65535),this._analysisValueAttribute("y",r,0,65535),t+=this._analysisValueAttribute("width",o,0,65535),t+=this._analysisValueAttribute("height",a,0,65535),null==n.context)throw Error('Argument "context" is undefined.');return(t=t+">"+this._encodeRasterImage(n.context.getImageData(i,r,o,a).data,o,a))+"</bitimage>"},p.prototype.createCutPaperElement=function(n){var t="<cutpaper";return null!=n&&(t+=this._analysisEnumAttribute("feed",n.feed,/^(false|true)$/),t+=this._analysisEnumAttribute("type",n.type,/^(full|partial)$/)),t+"/>"},p.prototype.createFeedElement=function(n){var t;if(null==n)throw Error("Argument is undefined.");if(null==n.line&&null==n.unit)throw Error('Argument "line / unit" is undefined.');return t="<feed"+this._analysisValueAttribute("line",n.line,1,255),(t+=this._analysisValueAttribute("unit",n.unit,1,255))+"/>"},p.prototype.createInitializationElement=function(n){var t="<initialization";return null!=n&&(t+=this._analysisEnumAttribute("reset",n.reset,/^(false|true)$/),t+=this._analysisEnumAttribute("print",n.print,/^(false|true)$/)),t+"/>"},p.prototype.createLogoElement=function(n){var t="<logo";return null!=n&&(t+=this._analysisEnumAttribute("width",n.width,/^(single|double)$/),t+=this._analysisEnumAttribute("height",n.height,/^(single|double)$/),t+=this._analysisValueAttribute("number",n.number,1,255)),t+"/>"},p.prototype.createPdf417Element=function(n){var t;if(null==n)throw Error("Argument is undefined.");if(t="<pdf417"+this._analysisEnumAttribute("level",n.level,/^(level[0-8])$/),null!=n.line&&(t=0!=n.line?t+this._analysisValueAttribute("line",n.line,3,90):t+' line="0"'),t+=this._analysisValueAttribute("column",n.column,0,30),t+=this._analysisValueAttribute("module",n.module,1,8),t+=this._analysisValueAttribute("aspect",n.aspect,1,8),null==n.data)throw Error('Argument "data" is undefined.');return(t=t+">"+this._encodeEscapeSequenceBinary(n.data))+"</pdf417>"},p.prototype.createPeripheralElement=function(n){var t="<peripheral";return null!=n&&(t+=this._analysisValueAttribute("channel",n.channel,1,2),t+=this._analysisValueAttribute("on",n.on,1,65535),t+=this._analysisValueAttribute("off",n.off,1,65535)),t+"/>"},p.prototype.createQrCodeElement=function(n){var t;if(null==n)throw Error("Argument is undefined.");if(t="<qrcode"+this._analysisEnumAttribute("model",n.model,/^(model[12])$/),t+=this._analysisEnumAttribute("level",n.level,/^(level_[lmqh])$/),t+=this._analysisValueAttribute("cell",n.cell,1,8),null==n.data)throw Error('Argument "data" is undefined.');return(t=t+">"+this._encodeEscapeSequenceBinary(n.data))+"</qrcode>"},p.prototype.createRawDataElement=function(n){if(null==n)throw Error("Argument is undefined.");if(null==n.data)throw Error('Argument "data" is undefined.');return(n="<rawdata>"+this._encodeBase64Binary(n.data))+"</rawdata>"},p.prototype.createRuledLineElement=function(n){var t="<ruledline";return null!=n&&(t+=this._analysisEnumAttribute("thickness",n.thickness,/^(thin|medium|thick|double_(thin|medium|thick))$/),t+=this._analysisValueAttribute("width",n.width,1,65535)),t+"/>"},p.prototype.createSoundElement=function(n){var t="<sound";return null!=n&&(t+=this._analysisValueAttribute("channel",n.channel,1,2),t+=this._analysisValueAttribute("repeat",n.repeat,1,20)),t+"/>"},p.prototype.createTextElement=function(n){var t;if(null==n)throw Error("Argument is undefined.");return t="<text"+this._analysisEnumAttribute("emphasis",n.emphasis,/^(false|true)$/),t+=this._analysisEnumAttribute("invert",n.invert,/^(false|true)$/),t+=this._analysisEnumAttribute("linespace",n.linespace,/^(24|32)$/),t+=this._analysisEnumAttribute("font",n.font,/^(font_[ab])$/),t+=this._analysisEnumAttribute("underline",n.underline,/^(false|true)$/),t+=this._analysisValueAttribute("characterspace",n.characterspace,0,7),t+=this._analysisValueAttribute("width",n.width,1,6),t+=this._analysisValueAttribute("height",n.height,1,6),t+=this._analysisEnumAttribute("codepage",n.codepage,/^(cp(437|737|772|774|851|852|855|857|858|860|861|862|863|864|865|866|869|874|928|932|998|999|1001|1250|1251|1252|2001|3001|3002|3011|3012|3021|3041|3840|3841|3843|3844|3845|3846|3847|3848)|utf8|blank|utf8|shift_jis|gb18030|gb2312|big5|korea)$/),t+=this._analysisEnumAttribute("international",n.international,/^(usa|france|germany|uk|denmark|sweden|italy|spain|japan|norway|denmark2|spain2|latin_america|korea|ireland|legal)$/),null!=n.data?(t+=">",t=1==n.binary?t+this._encodeEscapeSequenceBinary(n.data):t+this._encodeEscapeSequence(n.data),t+="</text>"):t+="/>",t},p.prototype.createHoldPrintElement=function(n){var t="<holdprint";return null!=n&&(t+=this._analysisEnumAttribute("type",n.type,/^(valid|invalid|default)$/)),t+"/>"},p.prototype._analysisEnumAttribute=function(n,t,i){if(null!=t){if(!i.test(t))throw Error('Argument "'+n+'" is invalid.');return" "+n+'="'+t+'"'}return""},p.prototype._analysisValueAttribute=function(n,t,i,r){if(null!=t){if(t<i||t>r)throw Error('Argument "'+n+'" is invalid.');return" "+n+'="'+t+'"'}return""},p.prototype._encodeEscapeSequence=function(n){var t=/[\\\x00-\x20\x26\x3c\x3e\x7f]/g;return t.test(n)&&(n=n.replace(t,function(i){return"\\"==i?"\\\\":"\\x"+("0"+i.charCodeAt(0).toString(16)).slice(-2)})),n},p.prototype._encodeEscapeSequenceBinary=function(n){var t=/[\\\x00-\x20\x26\x3c\x3e\x7f-\xff]/g;return t.test(n)&&(n=n.replace(t,function(i){return"\\"==i?"\\\\":"\\x"+("0"+i.charCodeAt(0).toString(16)).slice(-2)})),n},p.prototype._encodeBase64Binary=function(n){var t="",i=n.length;n+="\0\0";for(var r=0;r<i;r+=3){var o=n.charCodeAt(r)<<16|n.charCodeAt(r+1)<<8|n.charCodeAt(r+2);t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&o)}switch(i%3){case 1:return t.slice(0,-2)+"==";case 2:return t.slice(0,-1)+"="}return t},p.prototype._encodeRasterImage=function(n,t,i){for(var r=[[-254,-126,-222,-94,-246,-118,-214,-86],[-62,-190,-30,-158,-54,-182,-22,-150],[-206,-78,-238,-110,-198,-70,-230,-102],[-14,-142,-46,-174,-6,-134,-38,-166],[-242,-114,-210,-82,-250,-122,-218,-90],[-50,-178,-18,-146,-58,-186,-26,-154],[-194,-66,-226,-98,-202,-74,-234,-106],[-2,-130,-34,-162,-10,-138,-42,-170]],o="",a=0,c=0;c<i;c++){for(var f=0,v=128,k=0;k<t;k++)((30*n[a]+59*n[a+1]+11*n[a+2])*n[a+3]+12800)/25500-n[a+3]<r[7&c][7&k]&&(f|=v),a+=4,0==(v>>=1)&&(o+=String.fromCharCode(f),f=0,v=128);128!=v&&(o+=String.fromCharCode(f))}for(n=o,o="",t=n.length,n+="\0\0",c=0;c<t;c+=3)i=n.charCodeAt(c)<<16|n.charCodeAt(c+1)<<8|n.charCodeAt(c+2),o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&i);switch(t%3){case 1:return o.slice(0,-2)+"==";case 2:return o.slice(0,-1)+"="}return o};class Fe extends R{constructor(){super(),this.builder=new p}init(){return this.request+=this.builder.createInitializationElement(),this}setJustification(t="left"){return this.request+=this.builder.createAlignmentElement({position:t}),this}setBold(t=!0){return this.request+=this.builder.createTextElement({emphasis:t}),this}setUnderline(t=!0){return this.request+=this.builder.createTextElement({underline:t}),this}setInverse(t=!0){return this.request+=this.builder.createTextElement({invert:t}),this}writeLine(t){return this.request+=this.builder.createTextElement({data:`${t}\n`}),this}setSize(t="normal"){let i;return i="large"===t?2:1,this.request+=this.builder.createTextElement({width:i,height:i}),this}cut(t="full"){return this.request+=this.builder.createCutPaperElement({feed:!0,type:t}),this}feed(t=1){return this.request+=this.builder.createFeedElement({line:t}),this}flush(){return this.request}}const S=27;class Je extends R{constructor(){super(),this.encoder=new TextEncoder}init(){return this.buffer=new X,this.write(S),this.write("@"),this}flush(){return this.buffer.flush()}feed(t=1){return this.write(S),this.write("d"),this.write(t),this}cut(t="full"){return this.write(29),this.write("V"),this.write("full"===t?1:0),this}writeLine(t){return this.write(`${t}\n`)}setInverse(t=!0){return this.write(29),this.write("B"),this.write(t?1:0),this}setUnderline(t=!0){return this.write(S),this.write("-"),this.write(t?1:0),this}setJustification(t="left"){let i;switch(t){case"center":i=1;break;case"right":i=2;break;default:i=0}return this.write(S),this.write("a"),this.write(i),this}setBold(t=!0){return this.write(S),this.write("E"),this.write(t?1:0),this}setSize(t="normal"){return this.write(S),this.write("!"),this.write("normal"===t?0:48),this}write(t){return"number"==typeof t?this.buffer.writeUInt8(t):this.buffer.write("string"==typeof t?this.encoder.encode(t):t),this}}let Le=(()=>{class n extends R{constructor(){super(),this.isConnected=new B.X(!1)}setDriver(i,r="ESC/POS"){return this.driver=i,this.printLanguage=r,this.driver.connect(),this.driver.isConnected.subscribe(o=>{this.isConnected.next(o)}),this}init(){if(!this.driver)throw"Cannot initiate the print service.  No connection detected.";switch(this.printLanguage){case"WebPRNT":this.builder=new Fe;break;case"StarPRNT":this.builder=new Qe;break;default:this.builder=new Je}return this.builder.init(),this}cut(i="full"){return this.builder.cut(i),this}feed(i=1){return this.builder.feed(i),this}setInverse(i=!0){return this.builder.setInverse(i),this}setBold(i=!0){return this.builder.setBold(i),this}setUnderline(i=!0){return this.builder.setUnderline(i),this}setJustification(i="left"){return this.builder.setJustification(i),this}setSize(i="normal"){return this.builder.setSize(i),this}writeLine(i=""){return this.builder.writeLine(i),this}flush(){this.driver.write(this.builder.flush())}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=(0,e.Yz7)({factory:function(){return new n},token:n,providedIn:"root"}),n})();class ee{}var u=function(n){this.papertype=this.checkedblock=this.url=null,this.timeout=9e4,this.onTimeout=this.onError=this.onReceive=null,this.holdprint_timeout=void 0,this._json=this._url=null,null!=n&&(null!=n.url&&(this.url=n.url),null!=n.checkedblock&&(this.checkedblock=n.checkedblock),null!=n.papertype&&(this.papertype=n.papertype),null!=n.timeout&&(this.timeout=n.timeout),null!=n.holdprint_timeout&&(this.holdprint_timeout=n.holdprint_timeout))},U={};u.prototype._callMessageHandler=function(){var n=this;null==U[n._url]?(U[n._url]=n,webkit.messageHandlers.sendMessageHandler.postMessage(n._json)):setTimeout(function(){n._callMessageHandler()},500)},u.prototype.sendMessage=function(n){var i,t="<root";if(null!=n.checkedblock?0==n.checkedblock&&(t+=' checkedblock="false"'):0==this.checkedblock&&(t+=' checkedblock="false"'),null!=n.papertype?"normal"==n.papertype?t+=' papertype="normal"':"black_mark"==n.papertype?t+=' papertype="black_mark"':"black_mark_and_detect_at_power_on"==n.papertype&&(t+=' papertype="black_mark_and_detect_at_power_on"'):"normal"==this.papertype?t+=' papertype="normal"':"black_mark"==this.papertype?t+=' papertype="black_mark"':"black_mark_and_detect_at_power_on"==this.papertype&&(t+=' papertype="black_mark_and_detect_at_power_on"'),null!=n.holdprint_timeout?t+=' holdprint_timeout="'+n.holdprint_timeout+'"':null!=this.holdprint_timeout&&(t+=' holdprint_timeout="'+this.holdprint_timeout+'"'),i='<StarWebPrint xmlns="http://www.star-m.jp" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Request>',i+=this._encodeEscapeSequence(t=t+">"+n.request+"</root>"),i+="</Request>",i+="</StarWebPrint>",t="",/^https?:\/\/(localhost|127\.0\.0\.1):8001\//.test((t=null!=n.url?n.url:this.url).toLowerCase())&&-1!=navigator.userAgent.indexOf("webPRNTSupportMessageHandler"))this._json=JSON.stringify({url:t,body:i}),this._url=t,this._callMessageHandler();else{var r=null;if(window.XMLHttpRequest)r=new XMLHttpRequest;else{if(!window.ActiveXObject)return void(this.onError&&this.onError({status:10001,responseText:"XMLHttpRequest is not supported."}));r=new ActiveXObject("Microsoft.XMLHTTP")}(-1!=navigator.userAgent.indexOf("iPad;")||-1!=navigator.userAgent.indexOf("iPhone;")||-1!=navigator.userAgent.indexOf("iPod touch;")||-1!=navigator.userAgent.indexOf("Android"))&&-1==navigator.userAgent.indexOf("WebPRNTSupportHTTPS")&&(0==t.toLowerCase().indexOf("https://localhost")||0==t.toLowerCase().indexOf("https://127.0.0.1"))&&(t="http://"+t.substring(8));try{r.open("POST",t,!0)}catch(a){return void(this.onError&&this.onError({status:10002,responseText:a.message}))}try{null!=n.timeout?r.timeout=n.timeout:this.timeout&&(r.timeout=this.timeout)}catch{}r.setRequestHeader("Content-Type","text/xml; charset=UTF-8");var o=this;r.onreadystatechange=function(){if(4==r.readyState)try{if(200==r.status){var a=r.responseXML.getElementsByTagName("Response");if(0<a.length){if(o.onReceive){var c=a[0].childNodes[0].nodeValue;o.onReceive({traderSuccess:c.slice(c.indexOf("<success>")+9,c.indexOf("</success>")),traderCode:c.slice(c.indexOf("<code>")+6,c.indexOf("</code>")),traderStatus:c.slice(c.indexOf("<status>")+8,c.indexOf("</status>")),status:r.status,responseText:r.responseText})}}else o.onError&&o.onError({status:r.status,responseText:r.responseText})}else o.onError&&o.onError({status:r.status,responseText:r.responseText})}catch{o.onError&&o.onError({status:0,responseText:"Connection timeout occurred."})}};try{r.ontimeout=function(){o.onTimeout&&o.onTimeout()}}catch{}try{r.send(i)}catch(a){this.onError&&this.onError({status:10003,responseText:a.message})}}},u.prototype._onHandlerSuccess=function(n){trader.onReceive&&trader.onReceive(n)},u.prototype._onHandlerError=function(n){trader.onError&&trader.onError(n)},u.prototype.isCoverOpen=function(n){return!!(32&parseInt(n.traderStatus.substr(4,2),16))},u.prototype.isOffLine=function(n){return!!(8&parseInt(n.traderStatus.substr(4,2),16))},u.prototype.isCompulsionSwitchClose=function(n){return!!(4&parseInt(n.traderStatus.substr(4,2),16))},u.prototype.isEtbCommandExecute=function(n){return!!(2&parseInt(n.traderStatus.substr(4,2),16))},u.prototype.isHighTemperatureStop=function(n){return!!(64&parseInt(n.traderStatus.substr(6,2),16))},u.prototype.isNonRecoverableError=function(n){return!!(32&parseInt(n.traderStatus.substr(6,2),16))},u.prototype.isAutoCutterError=function(n){return!!(8&parseInt(n.traderStatus.substr(6,2),16))},u.prototype.isBlackMarkError=function(n){return!!(8&parseInt(n.traderStatus.substr(8,2),16))},u.prototype.isPaperEnd=function(n){return!!(8&parseInt(n.traderStatus.substr(10,2),16))},u.prototype.isPaperNearEnd=function(n){return!!(4&parseInt(n.traderStatus.substr(10,2),16))},u.prototype.isPaperPresent=function(n){return!!(2&parseInt(n.traderStatus.substr(12,2),16))},u.prototype.extractionEtbCounter=function(n){var t=0;return 64&parseInt(n.traderStatus.substr(14,2),16)&&(t|=16),32&parseInt(n.traderStatus.substr(14,2),16)&&(t|=8),8&parseInt(n.traderStatus.substr(14,2),16)&&(t|=4),4&parseInt(n.traderStatus.substr(14,2),16)&&(t|=2),2&parseInt(n.traderStatus.substr(14,2),16)&&(t|=1),t},u.prototype._encodeEscapeSequence=function(n){var t=/[<>&]/g;return t.test(n)&&(n=n.replace(t,function(i){switch(i){case"<":return"&lt;";case">":return"&gt;"}return"&amp;"})),n};class qe extends ee{constructor(t,i=!1){super(),this.isConnected=new B.X(!1),this.useSecure=!1,this.isStarPrinter=!1,this.url=t,this.useSecure=i}connect(){this.trader=new u({url:`http${this.useSecure?"s":""}://${this.url}/StarWebPRNT/SendMessage`}),this.trader.onReceive=i=>{this.isConnected.next(!0)},this.trader.onError=i=>{this.isConnected.next(!1)},this.trader.sendMessage("")}write(t){return(0,W.mG)(this,void 0,void 0,function*(){this.trader.sendMessage({request:t})})}}class z extends ee{constructor(t,i){super(),this.isConnected=new B.X(!1),this.vendorId=t,this.productId=i}connect(){navigator.usb.getDevices().then(t=>(this.device=t.find(i=>i.vendorId===this.vendorId&&i.productId===this.productId),console.log(this.device),this.device.open())).then(()=>this.device.selectConfiguration(1)).then(()=>this.device.claimInterface(0)).then(t=>{this.endPoint=this.device.configuration.interfaces[0].alternate.endpoints.find(r=>"out"===r.direction),this.isConnected.next(!0),this.listenForUsbConnections()}).catch(t=>{this.isConnected.next(!1)})}requestUsb(){return new Ue.y(t=>{navigator.usb.requestDevice({filters:[]}).then(i=>(this.vendorId=i.vendorId,this.productId=i.productId,t.next(i))).catch(i=>t.error(i))})}write(t){return(0,W.mG)(this,void 0,void 0,function*(){this.device.transferOut(this.endPoint.endpointNumber,t)})}listenForUsbConnections(){navigator.usb.addEventListener("disconnect",()=>{this.isConnected.next(!1)}),navigator.usb.addEventListener("connect",()=>{this.isConnected.next(!0)})}}var te=s(8675),ie=s(4004),b=s(2722);class Z{constructor(t,i,r){this.data=t,this.dialogRef=i,this.json=r,this.precio=0,this.precioBase=0,this.descuento=0}ngOnInit(){this.precio=this.data.precioUnitario,this.precioBase=this.data.precioBase,this.descuento=this.data.descuento}updateProd(){const t=this.calculaImpuesto("");this.data.precioBase=this.precioBase,this.data.precioUnitario=this.precio,this.data.descuento=this.descuento,this.data.subTotal=this.data.precioBase*this.data.cantidad,this.data.impuesto=t,this.data.total=this.data.precioBase*this.data.cantidad-this.descuento+t,this.dialogRef.close({data:this.data})}calculaPrecioConImpuesto(t){let i=0;this.data.impuestos&&this.data.impuestos.forEach(r=>{i+=+r.porcentaje/100*+this.precioBase}),this.precio=+this.precioBase+i}calculaImpuesto(t){let i=0;return this.data.impuestos&&this.data.impuestos.forEach(r=>{i+=+r.porcentaje/100*(+this.precioBase*this.data.cantidad-this.descuento)}),i}}Z.\u0275fac=function(t){return new(t||Z)(e.Y36(g.WI),e.Y36(g.so),e.Y36(m.Ts))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["edit-product"]],decls:22,vars:5,consts:[["mat-dialog-title","",1,"text-2xl","font-extrabold","tracking-tight"],["mat-dialog-content","",1,"flex","border-b"],[1,"flex","flex-col","w-full","mt-4"],[1,"flex"],[1,"w-1/3","mr-2"],["matInput","",3,"ngModel","ngModelChange","keyup"],["matInput","",3,"ngModel","disabled","ngModelChange"],["matInput","",3,"ngModel","ngModelChange"],["mat-dialog-actions","",1,"text-right"],["mat-button","","mat-dialog-close","",3,"click"],["mat-button","","mat-dialog-close","","cdkFocusInitial","",3,"color","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1,"Ajuste de producto"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),e._uU(7,"Precio base"),e.qZA(),e.TgZ(8,"input",5),e.NdJ("ngModelChange",function(o){return i.precioBase=o})("keyup",function(o){return i.calculaPrecioConImpuesto(o)}),e.qZA()(),e.TgZ(9,"mat-form-field",4)(10,"mat-label"),e._uU(11,"Precio unitario"),e.qZA(),e.TgZ(12,"input",6),e.NdJ("ngModelChange",function(o){return i.precio=o}),e.qZA()(),e.TgZ(13,"mat-form-field",4)(14,"mat-label"),e._uU(15,"Descuento"),e.qZA(),e.TgZ(16,"input",7),e.NdJ("ngModelChange",function(o){return i.descuento=o}),e.qZA()()()()(),e.TgZ(17,"div",8)(18,"button",9),e.NdJ("click",function(){return i.updateProd()}),e._uU(19,"Cancelar"),e.qZA(),e.TgZ(20,"button",10),e.NdJ("click",function(){return i.updateProd()}),e._uU(21,"Actualizar"),e.qZA()()),2&t&&(e.xp6(8),e.Q6J("ngModel",i.precioBase),e.xp6(4),e.Q6J("ngModel",i.precio)("disabled",!0),e.xp6(4),e.Q6J("ngModel",i.descuento),e.xp6(4),e.Q6J("color","primary"))},dependencies:[M.eB,h.v_,h.$V,O.k0,l.Fj,l.JJ,l.On,g.ZT,g.uh,g.xY,g.H8],encapsulation:2});var ne=s(2270),re=s(826),oe=s(9349);function Be(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Contacto"),e.qZA())}function ze(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Tipo"),e.qZA())}function He(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Notas"),e.qZA())}const ae=function(n){return{"mt-6":n}};function Ve(n,t){if(1&n){const i=e.EpF();e.ynx(0),e.TgZ(1,"div",33)(2,"button",34),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().index,a=e.oxw();return e.KtG(a.removePhoneNumberField(o))}),e._UZ(3,"mat-icon",22),e.qZA()(),e.BQk()}if(2&n){const i=e.oxw().first;e.xp6(1),e.Q6J("ngClass",e.VKq(2,ae,i)),e.xp6(2),e.Q6J("svgIcon","heroicons_solid:trash")}}function je(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"div",27)(2,"mat-form-field",28),e.YNc(3,Be,2,0,"mat-label",29),e._UZ(4,"mat-icon",30)(5,"input",31),e.qZA(),e.TgZ(6,"mat-form-field",28),e.YNc(7,ze,2,0,"mat-label",29),e._UZ(8,"mat-icon",30)(9,"input",31),e.qZA(),e.TgZ(10,"mat-form-field",32),e.YNc(11,He,2,0,"mat-label",29),e._UZ(12,"mat-icon",30)(13,"input",31),e.qZA(),e.YNc(14,Ve,4,4,"ng-container",29),e.qZA(),e.BQk()),2&n){const i=t.$implicit,r=t.first,o=t.last;e.xp6(3),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:phone"),e.xp6(1),e.Q6J("formControl",i.get("contacto"))("placeholder","Telefono"),e.xp6(2),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:tag"),e.xp6(1),e.Q6J("formControl",i.get("etiqueta"))("placeholder","Etiqueta"),e.xp6(2),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:annotation"),e.xp6(1),e.Q6J("formControl",i.get("observaciones"))("placeholder","Notas"),e.xp6(1),e.Q6J("ngIf",!(r&&o))}}function Ye(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Tel\xe9fono"),e.qZA())}function $e(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Tipo"),e.qZA())}function Ge(n,t){1&n&&(e.TgZ(0,"mat-label"),e._uU(1,"Parentesco"),e.qZA())}function We(n,t){if(1&n){const i=e.EpF();e.ynx(0),e.TgZ(1,"div",33)(2,"button",34),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().index,a=e.oxw();return e.KtG(a.removeReferenciaField(o))}),e._UZ(3,"mat-icon",22),e.qZA()(),e.BQk()}if(2&n){const i=e.oxw().first;e.xp6(1),e.Q6J("ngClass",e.VKq(2,ae,i)),e.xp6(2),e.Q6J("svgIcon","heroicons_solid:trash")}}function Xe(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"div",27)(2,"mat-form-field",28),e.YNc(3,Ye,2,0,"mat-label",29),e._UZ(4,"mat-icon",30)(5,"input",31),e.qZA(),e.TgZ(6,"mat-form-field",28),e.YNc(7,$e,2,0,"mat-label",29),e._UZ(8,"mat-icon",30)(9,"input",31),e.qZA(),e.TgZ(10,"mat-form-field",32),e.YNc(11,Ge,2,0,"mat-label",29),e._UZ(12,"mat-icon",30)(13,"input",31),e.qZA(),e.YNc(14,We,4,4,"ng-container",29),e.qZA(),e.BQk()),2&n){const i=t.$implicit,r=t.first,o=t.last;e.xp6(3),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:phone"),e.xp6(1),e.Q6J("formControl",i.get("contacto"))("placeholder","Telefono"),e.xp6(2),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:tag"),e.xp6(1),e.Q6J("formControl",i.get("etiqueta"))("placeholder","Etiqueta"),e.xp6(2),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControl",i.get("observaciones"))("placeholder","Notas"),e.xp6(1),e.Q6J("ngIf",!(r&&o))}}class C{constructor(t,i,r,o){this._formBuilder=t,this._changeDetectorRef=i,this._personalService=r,this._posService=o}ngOnInit(){this.accountForm=this._formBuilder.group({id:[this.idCliente],cliente:[!0],nombre:[""],segundoNombre:[""],apellidoPaterno:[""],apellidoMaterno:[""],fechaNacimiento:[""],rfc:[""],curp:[""],sexo:[""],status:[""],estadoCivil:[""],escolaridad:[""],titulo:[""],ocupacion:[""],tipoPersona:[""],membresia:[""],empresa:[""],direccion:this._formBuilder.group({calle:[""],numeroInterior:[""],codigoPostal:["",l.kI.required],colonia:[""],ciudad:[""],estado:[""],pais:[""],entreCalles:[""],referencias:[""],ubicacion:this._formBuilder.group({type:[""],coordinates:[[]]})}),formasContacto:[[]],contactForm:this._formBuilder.group({referencias:this._formBuilder.array([]),phoneNumbers:this._formBuilder.array([])})})}updateProd(){let t=this.accountForm.getRawValue();t.id=this.idCliente;let i=this.accountForm.controls.contactForm.getRawValue(),r=i.referencias.filter(a=>a.contacto);const o=i.phoneNumbers.filter(a=>a.contacto);o&&o.length>0&&(r=r.concat(o)),t.formasContacto=r,this._personalService.updateCliente(t.id,t).subscribe(a=>{this._posService.addCliente(a).subscribe()})}addReferenciaField(){const t=this._formBuilder.group({contacto:[""],observaciones:[""],tipoContacto:["REFERENCIA"],etiqueta:new l.NI({value:"REFERENCIA",disabled:!0},l.kI.required)});this.accountForm.controls.contactForm.get("referencias").push(t),this._changeDetectorRef.markForCheck()}addPhoneNumberField(){const t=this._formBuilder.group({contacto:[""],observaciones:[""],tipoContacto:["telefono"],etiqueta:[""]});this.accountForm.controls.contactForm.get("phoneNumbers").push(t),this._changeDetectorRef.markForCheck()}trackByFn(t,i){return i.contacto||t}}C.\u0275fac=function(t){return new(t||C)(e.Y36(l.qu),e.Y36(e.sBO),e.Y36(ne.f),e.Y36(re.b))},C.\u0275cmp=e.Xpm({type:C,selectors:[["registro-rapido-cte"]],inputs:{idCliente:"idCliente"},decls:100,vars:37,consts:[[1,"flex","flex-col","border-b"],[1,"grid","grid-cols-10","gap-2","md:gap-4","w-full","mt-8",3,"formGroup"],["matInput","",3,"hidden","formControlName"],[1,"col-span-10","sm:col-span-2"],[1,"fuse-mat-no-subscript","w-full"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControlName"],[1,"col-span-5","sm:col-span-4"],[1,"col-span-5","sm:col-span-5"],["formGroupName","direccion"],[1,"col-span-3","sm:col-span-5"],[1,"col-span-1"],[1,"col-span-2"],[1,"fuse-mat-no-subscript","w-full",3,"floatLabel"],[1,"col-span-4","sm:col-span-3"],[1,"fuse-mat-textarea","fuse-mat-no-subscript","w-full"],["matInput","","cdkTextareaAutosize","",3,"formControlName","cdkAutosizeMinRows"],["formGroupName","contactForm"],[1,"col-span-5","mt-8"],[1,"space-y-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"group","inline-flex","items-center","mt-2","-ml-4","py-2","px-4","rounded","cursor-pointer",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"ml-2","font-medium","text-secondary","group-hover:underline"],[1,"text-right"],["mat-button",""],["mat-button","","cdkFocusInitial","",3,"color","click"],[1,"flex"],[1,"fuse-mat-no-subscript","flex-auto","mr-2","max-w-24","sm:max-w-40"],[4,"ngIf"],["matPrefix","",1,"hidden","sm:flex","icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","placeholder"],[1,"fuse-mat-no-subscript","flex-auto","w-full"],[1,"flex","items-center","w-10","pl-2",3,"ngClass"],["mat-icon-button","","matTooltip","Remove",1,"w-8","h-8","min-h-8",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"input",2),e.TgZ(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),e._uU(6,"Titulo"),e.qZA(),e._UZ(7,"mat-icon",5)(8,"input",6),e.qZA()(),e.TgZ(9,"div",7)(10,"mat-form-field",4)(11,"mat-label"),e._uU(12,"Nombre"),e.qZA(),e._UZ(13,"mat-icon",5)(14,"input",6),e.qZA()(),e.TgZ(15,"div",7)(16,"mat-form-field",4)(17,"mat-label"),e._uU(18,"Segundo nombre"),e.qZA(),e._UZ(19,"mat-icon",5)(20,"input",6),e.qZA()(),e.TgZ(21,"div",8)(22,"mat-form-field",4)(23,"mat-label"),e._uU(24,"Apellido paterno"),e.qZA(),e._UZ(25,"mat-icon",5)(26,"input",6),e.qZA()(),e.TgZ(27,"div",8)(28,"mat-form-field",4)(29,"mat-label"),e._uU(30,"Apellido materno"),e.qZA(),e._UZ(31,"mat-icon",5)(32,"input",6),e.qZA()(),e.ynx(33,9),e.TgZ(34,"div",10)(35,"mat-form-field",4)(36,"mat-label"),e._uU(37,"Calle y numero"),e.qZA(),e._UZ(38,"mat-icon",5)(39,"input",6),e.qZA()(),e.TgZ(40,"div",11)(41,"mat-form-field",4)(42,"mat-label"),e._uU(43,"Numero interior"),e.qZA(),e._UZ(44,"mat-icon",5)(45,"input",6),e.qZA()(),e.TgZ(46,"div",12)(47,"mat-form-field",4)(48,"mat-label"),e._uU(49,"C\xf3digo Postal"),e.qZA(),e._UZ(50,"mat-icon",5)(51,"input",6),e.qZA()(),e.TgZ(52,"div",12)(53,"mat-form-field",4)(54,"mat-label"),e._uU(55,"Colonia"),e.qZA(),e._UZ(56,"mat-icon",5)(57,"input",6),e.qZA()(),e.TgZ(58,"div",12)(59,"mat-form-field",13)(60,"mat-label"),e._uU(61,"Poblaci\xf3n"),e.qZA(),e._UZ(62,"mat-icon",5)(63,"input",6),e.qZA()(),e.TgZ(64,"div",12)(65,"mat-form-field",4)(66,"mat-label"),e._uU(67,"Estado"),e.qZA(),e._UZ(68,"mat-icon",5)(69,"input",6),e.qZA()(),e.TgZ(70,"div",14)(71,"mat-form-field",15)(72,"mat-label"),e._uU(73,"Entre calles"),e.qZA(),e._UZ(74,"textarea",16),e.qZA()(),e.TgZ(75,"div",14)(76,"mat-form-field",15)(77,"mat-label"),e._uU(78,"Referencias"),e.qZA(),e._UZ(79,"textarea",16),e.qZA()(),e.BQk(),e.ynx(80,17),e.TgZ(81,"div",18)(82,"div",19),e.YNc(83,je,15,13,"ng-container",20),e.qZA(),e.TgZ(84,"div",21),e.NdJ("click",function(){return i.addPhoneNumberField()}),e._UZ(85,"mat-icon",22),e.TgZ(86,"span",23),e._uU(87,"Agregar un numero de tel\xe9fono"),e.qZA()()(),e.TgZ(88,"div",18)(89,"div",19),e.YNc(90,Xe,15,13,"ng-container",20),e.qZA(),e.TgZ(91,"div",21),e.NdJ("click",function(){return i.addReferenciaField()}),e._UZ(92,"mat-icon",22),e.TgZ(93,"span",23),e._uU(94,"Agregar referencia"),e.qZA()()(),e.BQk(),e.qZA()(),e.TgZ(95,"div",24)(96,"button",25),e._uU(97,"Cancelar"),e.qZA(),e.TgZ(98,"button",26),e.NdJ("click",function(){return i.updateProd()}),e._uU(99,"Guardar"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("formGroup",i.accountForm),e.xp6(1),e.Q6J("hidden",!0)("formControlName","id"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:briefcase"),e.xp6(1),e.Q6J("formControlName","titulo"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","nombre"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","segundoNombre"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","apellidoPaterno"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","apellidoMaterno"),e.xp6(6),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","calle"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","numeroInterior"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:hashtag"),e.xp6(1),e.Q6J("formControlName","codigoPostal"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:location-marker"),e.xp6(1),e.Q6J("formControlName","colonia"),e.xp6(2),e.Q6J("floatLabel","always"),e.xp6(3),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("formControlName","ciudad"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:lock-closed"),e.xp6(1),e.Q6J("formControlName","estado"),e.xp6(5),e.Q6J("formControlName","entreCalles")("cdkAutosizeMinRows",5),e.xp6(5),e.Q6J("formControlName","referencias")("cdkAutosizeMinRows",5),e.xp6(4),e.Q6J("ngForOf",i.accountForm.controls.contactForm.get("phoneNumbers").controls)("ngForTrackBy",i.trackByFn),e.xp6(2),e.Q6J("svgIcon","heroicons_solid:plus-circle"),e.xp6(5),e.Q6J("ngForOf",i.accountForm.controls.contactForm.get("referencias").controls)("ngForTrackBy",i.trackByFn),e.xp6(2),e.Q6J("svgIcon","heroicons_solid:plus-circle"),e.xp6(6),e.Q6J("color","primary"))},dependencies:[m.mk,m.sg,m.O5,M.eB,h.v_,h.$V,h.g4,A.Hw,oe.IC,O.k0,J.Kd,l.Fj,l.JJ,l.JL,l.oH,l.sg,l.u,l.x0],encapsulation:2});var Ke=s(7821),et=s(7495),tt=s(9042),se=s(7400),le=s(4363),it=s(8214),nt=s(2308),rt=s(5314),ot=s(1829);function at(n,t){if(1&n&&e._UZ(0,"registro-rapido-cte",94),2&n){const i=e.oxw(2);e.Q6J("idCliente",i.idNuevo)}}function st(n,t){1&n&&(e.TgZ(0,"div",88)(1,"mat-expansion-panel",89),e.NdJ("opened",function(){return!0}),e.TgZ(2,"mat-expansion-panel-header",90)(3,"mat-panel-title",91)(4,"mat-icon",92),e._uU(5,"account_circle"),e.qZA(),e._uU(6," Datos del cliente "),e.qZA()(),e.YNc(7,at,1,1,"ng-template",93),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("expanded",!0))}function lt(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"mat-option",95),e._uU(2),e.qZA(),e.BQk()),2&n){const i=t.$implicit;e.xp6(1),e.Q6J("value",i.id),e.xp6(1),e.AsE(" ",i.nombre," ",i.apellidoPaterno," ")}}function ct(n,t){1&n&&(e.TgZ(0,"mat-option"),e._uU(1," Registrar "),e.qZA())}function pt(n,t){if(1&n&&(e.TgZ(0,"mat-option",95),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i),e.xp6(1),e.HOy(" ",i.nombre," ",i.segundoNombre," ",i.apellidoPaterno," ",i.apellidoMaterno," ")}}function dt(n,t){if(1&n&&(e.TgZ(0,"mat-option",95),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i),e.xp6(1),e.AsE(" ",null==i.producto?null:i.producto.producto," - ",null==i.producto?null:i.producto.modelo," ")}}function ut(n,t){if(1&n){const i=e.EpF();e.ynx(0),e._UZ(1,"div",96),e.TgZ(2,"div",97),e.NdJ("dblclick",function(){const a=e.CHM(i).$implicit,c=e.oxw();return e.KtG(c.openDialog(a))}),e.TgZ(3,"div",54)(4,"div",55),e._uU(5),e.qZA(),e.TgZ(6,"div",98),e._uU(7),e.qZA()(),e.TgZ(8,"div",99),e._uU(9),e.qZA()(),e.TgZ(10,"div",56)(11,"div",57)(12,"div",100),e._uU(13),e.qZA(),e.TgZ(14,"div",101),e._uU(15),e.ALo(16,"currency"),e.qZA(),e.TgZ(17,"div",102),e._uU(18),e.ALo(19,"currency"),e.qZA(),e.TgZ(20,"div",102),e._uU(21),e.ALo(22,"currency"),e.qZA(),e.TgZ(23,"div",103)(24,"button",104),e.NdJ("click",function(){const a=e.CHM(i).$implicit,c=e.oxw();return e.KtG(c.borrarProducto(a.id))}),e._UZ(25,"mat-icon",12),e.qZA()()()(),e.BQk()}if(2&n){const i=t.$implicit;e.xp6(5),e.Oqu(i.id+1),e.xp6(2),e.hij(" ",i.producto.producto," "),e.xp6(2),e.hij(" ",i.producto.descripcion," "),e.xp6(4),e.Oqu(i.cantidad),e.xp6(2),e.hij("",e.lcZ(16,8,i.precioUnitario)," "),e.xp6(3),e.Oqu(e.lcZ(19,10,i.descuento)),e.xp6(3),e.Oqu(e.lcZ(22,12,i.total)),e.xp6(4),e.Q6J("svgIcon","heroicons_solid:trash")}}function mt(n,t){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",21)(2,"mat-label"),e._uU(3,"Dias de pago"),e.qZA(),e._UZ(4,"mat-icon",27),e.TgZ(5,"mat-select",28)(6,"mat-option",95),e._uU(7,"Domingo"),e.qZA(),e.TgZ(8,"mat-option",95),e._uU(9,"Lunes"),e.qZA(),e.TgZ(10,"mat-option",95),e._uU(11,"Martes"),e.qZA(),e.TgZ(12,"mat-option",95),e._uU(13,"Miercoles"),e.qZA(),e.TgZ(14,"mat-option",95),e._uU(15,"Jueves"),e.qZA(),e.TgZ(16,"mat-option",95),e._uU(17,"Viernes"),e.qZA(),e.TgZ(18,"mat-option",95),e._uU(19,"Sabado"),e.qZA()()(),e.BQk()),2&n&&(e.xp6(4),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("formControlName","diaPago"),e.xp6(1),e.Q6J("value","Domingo"),e.xp6(2),e.Q6J("value","Lunes"),e.xp6(2),e.Q6J("value","Martes"),e.xp6(2),e.Q6J("value","Miercoles"),e.xp6(2),e.Q6J("value","Jueves"),e.xp6(2),e.Q6J("value","Viernes"),e.xp6(2),e.Q6J("value","Sabado"))}function ht(n,t){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",21)(2,"mat-label"),e._uU(3,"Dias de pago"),e.qZA(),e._UZ(4,"mat-icon",27)(5,"input",110),e.qZA(),e.BQk()),2&n&&(e.xp6(4),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("formControlName","diasPago"))}function ft(n,t){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",21)(2,"mat-label"),e._uU(3,"Dias de pago"),e.qZA(),e._UZ(4,"mat-icon",27)(5,"input",110),e.qZA(),e.BQk()),2&n&&(e.xp6(4),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("formControlName","diasPago"))}function gt(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"mat-option",95),e._uU(2),e.qZA(),e.BQk()),2&n){const i=t.$implicit;e.xp6(1),e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.ruta," ")}}function _t(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"div",111)(2,"mat-form-field",21)(3,"mat-label"),e._uU(4,"Ruta de cobro"),e.qZA(),e._UZ(5,"mat-icon",27),e.TgZ(6,"mat-select",28),e.YNc(7,gt,3,2,"ng-container",29),e.qZA()()(),e.BQk()),2&n){const i=e.oxw(2);e.xp6(5),e.Q6J("svgIcon","heroicons_solid:location-marker"),e.xp6(1),e.Q6J("formControlName","ruta"),e.xp6(1),e.Q6J("ngForOf",i.rutas)}}function vt(n,t){if(1&n){const i=e.EpF();e.ynx(0),e.TgZ(1,"div",105)(2,"mat-form-field",21)(3,"mat-label"),e._uU(4,"Pago inicial"),e.qZA(),e._UZ(5,"mat-icon",27),e.TgZ(6,"input",106,107),e.NdJ("input",function(){e.CHM(i);const o=e.MAs(7),a=e.oxw();return e.KtG(a.calculaSaldo(o.value))}),e.qZA()()(),e.TgZ(8,"div",108)(9,"mat-form-field",21)(10,"mat-label"),e._uU(11,"Saldo"),e.qZA(),e._UZ(12,"mat-icon",27)(13,"input",109),e.qZA()(),e.TgZ(14,"div",108)(15,"mat-form-field",32)(16,"mat-label"),e._uU(17,"Periodicidad de pago"),e.qZA(),e._UZ(18,"mat-icon",27),e.TgZ(19,"mat-select",28)(20,"mat-option",95),e._uU(21,"Semanal"),e.qZA(),e.TgZ(22,"mat-option",95),e._uU(23,"Quincenal"),e.qZA(),e.TgZ(24,"mat-option",95),e._uU(25,"Mensual"),e.qZA()()()(),e.TgZ(26,"div",108),e.YNc(27,mt,20,9,"ng-container",39),e.YNc(28,ht,6,2,"ng-container",39),e.YNc(29,ft,6,2,"ng-container",39),e.qZA(),e.TgZ(30,"div",108)(31,"mat-form-field",21)(32,"mat-label"),e._uU(33,"Monto de pago"),e.qZA(),e._UZ(34,"mat-icon",27)(35,"input",110),e.qZA()(),e.YNc(36,_t,8,3,"ng-container",39),e.BQk()}if(2&n){const i=e.oxw();e.xp6(5),e.Q6J("svgIcon","heroicons_solid:currency-dollar"),e.xp6(1),e.Q6J("formControlName","pagoInicial"),e.xp6(6),e.Q6J("svgIcon","heroicons_solid:currency-dollar"),e.xp6(1),e.Q6J("formControlName","saldo"),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("formControlName","periodicidadPago"),e.xp6(1),e.Q6J("value","Semanal"),e.xp6(2),e.Q6J("value","Quincenal"),e.xp6(2),e.Q6J("value","Mensual"),e.xp6(3),e.Q6J("ngIf","Semanal"==i.ventaForm.get("periodicidadPago").value),e.xp6(1),e.Q6J("ngIf","Quincenal"==i.ventaForm.get("periodicidadPago").value),e.xp6(1),e.Q6J("ngIf","Mensual"==i.ventaForm.get("periodicidadPago").value),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:currency-dollar"),e.xp6(1),e.Q6J("formControlName","montoPago"),e.xp6(1),e.Q6J("ngIf",i.habilitarCredito)}}function xt(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"mat-option",95),e._uU(2),e.qZA(),e.BQk()),2&n){const i=t.$implicit;e.xp6(1),e.Q6J("value",i),e.xp6(1),e.AsE(" ",i.claveSAT," - ",i.formaPago," ")}}function bt(n,t){1&n&&(e.TgZ(0,"div",112)(1,"mat-form-field",113),e._UZ(2,"input",85),e.TgZ(3,"span",114),e._uU(4,"#"),e.qZA()()()),2&n&&(e.xp6(2),e.Q6J("formControlName","folioVoucher")("placeholder","Notas documento"))}function St(n,t){if(1&n){const i=e.EpF();e.TgZ(0,"div",112)(1,"mat-form-field",115)(2,"input",116),e.NdJ("input",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.calculaCambio())}),e.qZA(),e.TgZ(3,"span",114),e._uU(4,"$"),e.qZA()(),e.TgZ(5,"mat-form-field",84)(6,"label",117),e._uU(7,"Cambio: "),e.qZA(),e._UZ(8,"input",118),e.TgZ(9,"span",114),e._uU(10,"$"),e.qZA()()()}2&n&&(e.xp6(2),e.Q6J("formControlName","pagaCon")("placeholder","Paga con"),e.xp6(6),e.Q6J("formControlName","cambio")("placeholder","Cambio"))}const Ct=function(){return["../"]},yt=function(){return{standalone:!0}};class w{constructor(t,i,r,o,a,c,f,v,k,Nt,Rt,Ut,Dt,Qt,Ft){this._activatedRoute=t,this._changeDetectorRef=i,this._router=r,this._POSService=o,this._inventoryService=a,this._formBuilder=c,this._userService=f,this._sucursalService=v,this._inventarioService=k,this._fuseAlertService=Nt,this._personalService=Rt,this.printService=Ut,this.datepipe=Dt,this.currencyPipe=Qt,this.dialog=Ft,this.selectedProduct=null,this._unsubscribeAll=new L.x,this.listaCompras=[],this.cantidad=1,this.subtotal=0,this.impuestos=0,this.descuento=0,this.total=0,this.mostrarListaClientes=!1,this.mostrarListaProductos=!1,this.mostrarRegistroRapidoCte=!1,this.textoCliente="Buscar cliente",this.textoProducto="Buscar articulo por codigo de barras, SKU o nombre",this.clienteBusc="",this.productoBusc="",this.sucursal="",this.numeroTicket="",this.observaciones="",this.mensajeWarn="",this.clienteSel=new l.NI(""),this.producto=new l.NI(""),this.idNuevo="",this.habilitarTipoVenta=!0,this.logoUrl="",this.status=!1,this.ip="",this.habilitarCredito=!1,this.sucursalOp=this._inventarioService.sucursalSeleccionada,this.usbPrintDriver=new z,this.printService.isConnected.subscribe(ce=>{this.status=ce,console.log(ce?"Connected to printer!!!":"Not connected to printer.")}),this.habilitarCredito=f.userO.empresa?.negocios?.includes("CREDITO"),this.logoUrl=f.userO.empresa?.logo}ngOnInit(){if(this.sucursal=this._activatedRoute.snapshot.paramMap.get("sucursal"),null==this.sucursalOp&&this._sucursalService.getSucursalOnline(this.sucursal).subscribe(t=>{this.sucursalOp=t,this._inventarioService.sucursalSeleccionada=this.sucursalOp,this._changeDetectorRef.markForCheck()}),this.filteredProds=this.producto.valueChanges.pipe((0,te.O)(""),(0,ie.U)(t=>this.filterProduct(t||""))),this.filteredCustomers=this.clienteSel.valueChanges.pipe((0,te.O)(""),(0,ie.U)(t=>this.filterCustomer(t||""))),this.ventaForm=this._formBuilder.group({producto:[""],tipo:["CONTADO",[l.kI.required]],fecha:[new Date],fechaRegistro:[new Date],vendedor:[this._userService.userO.id,[l.kI.required]],folio:[""],pagoInicial:["0"],saldo:["0"],periodicidadPago:["NA",[l.kI.required]],diaPago:["1",[l.kI.required]],montoPago:["0",[l.kI.required]],ruta:["0",[l.kI.required]],observaciones:[""],formaPago:["01",[l.kI.required]],folioVoucher:[""],pagaCon:[""],cambio:[""],email:["",[l.kI.email]]}),this._POSService.clientes$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.clientes=t,this._changeDetectorRef.markForCheck()}),this._POSService.vendedores$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.vendedores=t,this._changeDetectorRef.markForCheck()}),this._POSService.rutas$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.rutas=t,this._changeDetectorRef.markForCheck()}),this._POSService.formasPago$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.formasPago=t,this._changeDetectorRef.markForCheck()}),this._POSService.productos$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.productos=t,this._changeDetectorRef.markForCheck()}),this._inventoryService.brands$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.brands=t,this._changeDetectorRef.markForCheck()}),localStorage.getItem("printer-device")){const t=JSON.parse(localStorage.getItem("printer-device"));this.usbPrintDriver=new z(t.vendorId,t.productId),this.printService.setDriver(this.usbPrintDriver,1305===t.vendorId?"StarPRNT":"ESC/POS")}}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}filterProduct(t){let i=[];return t.producto?.producto&&(t=t.producto.producto),i=this.productos.filter(r=>r&&r.producto&&r.producto.producto.toLowerCase().includes(t.toLowerCase())||r.producto?.codigoBarras===t||r.producto?.sku===t),i&&1==i.length?i[0].producto&&i[0].producto.codigoBarras&&i[0].producto.codigoBarras.toLowerCase()==t.toLocaleLowerCase()&&(document.getElementById("cantidad").focus(),this.selectProduct(i[0]),this.agregarProduct(),i=[],document.getElementById("producto").focus()):i&&i.length>1&&(i=i.slice(0,100)),i}filterCustomer(t){t.nombre&&(t=t.nombre);let i=this.clientes;return i=this.clientes.filter(r=>r&&r.nombre&&r.nombre.toLowerCase().includes(t.toLowerCase())),i&&i.length>1&&(i=i.slice(0,100)),i}trackByFn(t,i){return i.id||t}borrarProducto(t){const i=this.listaCompras.findIndex(o=>o.id===t);let r=this.listaCompras[i];this._POSService.getProductById(r.idInv).subscribe(o=>{o.stockActual=o.stockActual+r.cantidad,this._POSService.updateProductById(o).subscribe(a=>{})}),i>-1&&this.listaCompras.splice(i,1),this.calcularTotales()}selectCustomer(t){t?(this.selectedCustomer=t,this.mostrarListaClientes=!1,this.mostrarListaProductos=!1,this.textoCliente="S: "+this.selectedCustomer.nombre+" "+this.selectedCustomer?.apellidoPaterno,this.clienteBusc="",this.ventaForm.get("email").patchValue(t.idExterno)):(this.mostrarRegistroRapidoCte=!0,this._personalService.createPersona().subscribe(i=>{this.idNuevo=i.id}))}selectProduct(t){t&&(this.selectedProduct=t,this.mostrarListaClientes=!1,this.mostrarListaProductos=!1,this.textoProducto="S: "+this.selectedProduct.producto.producto+" - "+(this.selectedProduct.producto?.modelo?this.selectedProduct.producto?.modelo:""),this.productoBusc="")}agregarProduct(){let t="";if(this.selectedProduct.marca){let r=this.brands.filter(o=>o.id===this.selectedProduct?.marca);r.length>0&&(t=" MARCA: "+r[0].marca)}let i=+this.selectedProduct.precioVenta;this._POSService.getProductById(this.selectedProduct.id).subscribe(r=>{if(r&&(r.stockActual-this.cantidad>=0||"SERVICIO"==r.tipo)){let o=0;r.impuestos&&r.impuestos.forEach(c=>{o+=+c.porcentaje/100*+r.precioBase*this.cantidad});let a=0;this.listaCompras.push({id:this.listaCompras.length,idInv:r.id,producto:this.selectedProduct.producto,descripcion:"SKU: "+this.selectedProduct.sku+t,cantidad:this.cantidad,precioBase:+this.selectedProduct.precioBase,precioUnitario:i,subTotal:this.selectedProduct.precioBase*this.cantidad,impuesto:o,impuestos:this.selectedProduct.impuestos,descuento:a,total:this.cantidad*this.selectedProduct.precioBase-a+o}),this.selectedProduct.stockActual=this.selectedProduct.stockActual-this.cantidad,this._POSService.updateProductById(this.selectProduct).subscribe(c=>{}),this.calcularTotales(),this.textoProducto="Buscar articulo por codigo de barras, SKU o nombre",this.selectedProduct=null,this.producto.setValue(""),document.getElementById("producto").focus(),this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges()}else this.mensajeWarn="No hay inventario sufuciente para la venta",this.textoProducto="Buscar articulo por codigo de barras, SKU o nombre",this.selectedProduct=null,this.producto.setValue(""),this.show("ventaNoOk")})}calcularTotales(){this.subtotal=0,this.impuestos=0,this.descuento=0,this.total=0,this.listaCompras.forEach(t=>{let i=0;t.impuestos&&t.impuestos.forEach(r=>{i+=+r.porcentaje/100*(+t.precioBase*t.cantidad-t.descuento)}),this.subtotal=+this.subtotal+ +t.precioBase*t.cantidad,this.descuento=this.descuento+ +t.descuento,this.impuestos=this.impuestos+i}),this.total=this.subtotal-this.descuento+this.impuestos}calculaCambio(){console.log("cambio");let t=0;t="CREDITO"===this.ventaForm.get("tipo").value?+this.ventaForm.get("pagaCon").value-+this.ventaForm.get("pagoInicial").value:+this.ventaForm.get("pagaCon").value-this.total,this.ventaForm.get("cambio").patchValue(t)}calculaSaldo(t){this.ventaForm.get("saldo").patchValue(this.total-t)}vender(){const t=this.ventaForm.getRawValue(),o={cliente:{id:this.selectedCustomer.id},sucursal:{id:this.sucursal},empresa:{id:this._userService.userO.empresa.id},personaRegistro:{id:this._userService.userO.id},productos:this.listaCompras,subtotal:this.subtotal,impuestos:this.impuestos,descuento:this.descuento,total:this.total,observaciones:this.observaciones,...t};this.venta=o,this._POSService.guardarVenta(o,this.sucursal).subscribe(a=>{if(a.id){this.venta=a,this.listaCompras=[],this.subtotal=0,this.impuestos=0,this.total=0,this.descuento=0,this.ventaForm.reset(),this.clienteSel.reset(),this.producto.reset();try{this.imprimir()}catch(c){console.log(c)}finally{console.log("finally")}this.show("ventaOk"),setTimeout(()=>{this._fuseAlertService.dismiss("ventaOk")},5e3)}else this.venta=null,this.mensajeWarn="No se ha podido registrar la venta, intente nuevamente",this.show("ventaNoOk");this.ventaForm.get("fecha").patchValue(new Date),this.ventaForm.get("tipo").patchValue("CONTADO"),this.ventaForm.get("formaPago").patchValue("01"),this.ventaForm.get("vendedor").patchValue(this._userService.userO),this._changeDetectorRef.markForCheck()})}imprimir(){this.printService.init().setBold(!0).setJustification("center").setSize("large").writeLine(this._userService.userO.empresa.empresa).setSize("normal").writeLine(this.sucursalOp?"SUC. "+this.sucursalOp.tipoSucursal.tipoSucursal+" "+this.sucursalOp.sucursal:"SUC. NO SELECCIONADA").writeLine(this.sucursalOp.direccion).writeLine(this.datepipe.transform(this.venta.fecha,"yyyy-MM-dd hh:mm:ss aa")).setBold(!1).writeLine(this.sucursalOp.encabezadoTicket).writeLine("--------------------").setJustification("left").writeLine("Cliente: "+this.venta.cliente.nombre+" "+this.venta.cliente.apellidoPaterno+" "+this.venta.cliente.apellidoMaterno).writeLine("Folio: "+this.venta.folio).writeLine("------------------------------------------").writeLine("CANT PRODUCTO            P.UNI.  DESC   SUBTOT  ");for(let t=0;t<this.venta.productos.length;t++){let i=this.venta.productos[t].cantidad+"    ",r=(this.venta.productos[t].producto.productoCorto&&""!=this.venta.productos[t].producto.productoCorto?this.venta.productos[t].producto.productoCorto:this.venta.productos[t].producto.producto)+"                                                                                                                                    ",o=this.currencyPipe.transform(this.venta.productos[t].precioUnitario)+"      ",a=this.currencyPipe.transform(this.venta.productos[t].descuento)+"      ",c=this.currencyPipe.transform(this.venta.productos[t].total)+"      ";this.printService.writeLine(i.substring(0,4)+" "+r.substring(0,68)+o.substring(0,8)+a.substring(0,7)+c.substring(0,8))}this.printService.feed(2).setJustification("center").writeLine("--------------------").setJustification("right").setBold(!0).writeLine("Subtotal: "+this.currencyPipe.transform(this.venta.subtotal)+" MXN").writeLine("Impuestos: "+this.currencyPipe.transform(this.venta.impuestos)+" MXN").setSize("large").writeLine("Total: $"+this.currencyPipe.transform(this.venta.total)+" MXN").setSize("normal").setBold(!1).writeLine("----------------------").writeLine("Forma de pago: "+this.venta.formaPago.formaPago.replace("\xe1","a").replace("\xe9","e").replace("\xed","i").replace("\xf3","o").replace("\xfa","u")).writeLine("Paga con: "+this.currencyPipe.transform(this.venta.pagaCon)+" MXN").writeLine("Cambio: "+this.currencyPipe.transform(this.venta.cambio)+" MXN").writeLine(this.venta.email?"email: "+this.venta.email:"").writeLine("Le atendio "+this._userService.userO.name).writeLine("").writeLine("").setJustification("center").writeLine(this.sucursalOp.pieTicket).writeLine("").writeLine("").writeLine("").cut("full").flush()}dismiss(t){this._fuseAlertService.dismiss(t)}show(t){this._fuseAlertService.show(t)}displayCl(t){return t&&t.nombre?t.nombre+" "+t.apellidoPaterno:""}displayPr(t){return t&&t.producto.producto?t.producto.producto+" - "+(t.producto?.modelo?t.producto?.modelo:""):""}onSelectionChanged(t){this.selectedCustomer=t.option.value,this.selectCustomer(this.selectedCustomer)}onSelectionChangedPr(t){this.selectedProduct=t.option.value}openDialog(t){this.dialog.open(Z,{data:t}).afterClosed().subscribe(r=>{let o=this.listaCompras.findIndex(a=>a.id===t.id);this.listaCompras[o]=r.data,this.calcularTotales(),this._changeDetectorRef.markForCheck()})}customerQuickRegister(){this.dialog.open(C,{data:document.getElementById("cliente").textContent}).afterClosed().subscribe(i=>{this._POSService.getClientes().subscribe(),this._changeDetectorRef.markForCheck()})}requestUsb(){this.usbPrintDriver.requestUsb().subscribe(t=>{let i=1305===t.vendorId?"StarPRNT":"ESC/POS";localStorage.setItem("printer-device",JSON.stringify({vendorId:t.vendorId,productId:t.productId})),this.printService.setDriver(new z(t.vendorId,t.productId),i)})}connectToWebPrint(){this.webPrintDriver=new qe(this.ip),this.printService.setDriver(this.webPrintDriver,"WebPRNT")}print(t){this.printService.init().setBold(!0).writeLine("Hello World!").setBold(!1).feed(4).cut("full").flush()}compareFn(t,i){return t.id===i.id}}w.\u0275fac=function(t){return new(t||w)(e.Y36(x.gz),e.Y36(e.sBO),e.Y36(x.F0),e.Y36(re.b),e.Y36(Ke.V),e.Y36(l.qu),e.Y36(et.K),e.Y36(tt.V),e.Y36(se.I),e.Y36(G.jm),e.Y36(ne.f),e.Y36(Le),e.Y36(m.uU),e.Y36(m.H9),e.Y36(g.uw))},w.\u0275cmp=e.Xpm({type:w,selectors:[["pos"]],decls:183,vars:93,consts:[[1,"w-full","max-h-screen","xl:h-screen"],[1,"sticky","top-0","left-0","right-0","z-[1000]",3,"appearance","dismissible","dismissed","name","type"],["fuseAlertTitle",""],[1,"flex-column","text-left"],[1,"relative","flex","flex-col","flex-0","justify-center","w-full","overflow-hidden","z-49","shadow","dark:shadow-none","print:hidden"],[1,"relative","dark","flex","flex-auto","justify-center","w-full","px-4","md:px-8","bg-gray-800","dark:bg-gray-900"],[1,"flex","items-center","w-full"],[1,"flex","items-center"],["alt","Logo image",1,"max-w-24","max-h-14",3,"src"],[1,"ml-4","sm:ml-12"],[1,"text-3xl"],[1,"smt-0","inline-flex"],[1,"icon-size-5",3,"svgIcon"],[3,"click"],[1,"flex","items-center","pl-2","ml-auto","space-x-0.5","sm:space-x-2"],[1,"ml-auto"],["mat-icon-button","",3,"routerLink","matTooltip"],[1,"hidden","sm:block"],[1,"grid","grid-cols-12","gap-2","w-full","mt-2","p-4","bg-card","rounded",3,"formGroup"],["class","col-span-12 sm:col-span-12 mb-6",4,"ngIf"],[1,"col-span-6","sm:col-span-3"],[1,"fuse-mat-no-subscript","w-full"],["matPrefix","",1,"hidden","sm:flex","icon-size-5",3,"svgIcon"],["matInput","",3,"matDatepicker","formControlName","placeholder"],["matSuffix","",3,"for"],["birthdayDatepicker",""],[1,"col-span-6","sm:col-span-4"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],[3,"formControlName"],[4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-3"],[1,"font-medium","mb-1"],[1,"w-full"],["type","text","autocomplete","off","matInput","",3,"formControlName","placeholder"],[1,"col-span-6","md:col-span-4"],["appearance","fill",1,"fuse-mat-no-subscript","w-full",3,"floatLabel"],["type","text","matInput","","id","cliente",3,"formControl","matAutocomplete","placeholder"],["autoActiveFirstOption","",3,"displayWith","optionSelected"],["auto","matAutocomplete"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"fuse-mat-no-subscript","w-full",3,"floatLabel"],["type","text","matInput","","id","producto",3,"formControl","matAutocomplete","placeholder","keydown.enter"],["autoP","matAutocomplete"],[1,"col-span-6","md:col-span-2"],["id","cantidad","type","number","autocomplete","off","placeholder","Cantidad","matInput","",3,"ngModelOptions","ngModel","ngModelChange"],[1,"col-span-6","md:col-span-2","md:pt-6"],["mat-stroked-button","",1,"btn","btn-default",3,"color","disabled","click"],[1,"inline-flex","items-center"],[1,"ml-1.5","icon-size-5",3,"svgIcon"],[1,"col-span-12","rounded-2xl","shadow"],[1,"grid","grid-cols-12"],[1,"col-span-12","md:col-span-10","md:pr-4","md:pl-4","pb-4","pt-4"],[1,"col-span-4","md:col-span-5","font-medium","mb-4"],[1,"flex","flex-row"],[1,"w-7"],[1,"col-span-8","md:col-span-7","font-medium","mb-4"],[1,"grid","grid-cols-8"],[1,"col-span-2","md:col-span-1","font-medium"],[1,"col-span-2","md:col-span-2","font-medium"],[1,"col-span-1","font-medium","text-center"],[1,"grid","grid-cols-12","lg:h-56","xl:h-96","overflow-y-auto",3,"scrollTop"],["scrollMe",""],[1,"lg:p-4","col-span-12","md:col-span-2","min-w-24"],[1,"col-span-2","md:col-span-8","font-medium","tracking-tight","text-secondary","mt-4","md:mt-0"],[1,"text-lg"],[1,"col-span-2","md:col-span-8","font-medium","tracking-tight","text-secondary","mt-4"],[1,"col-span-2","md:col-span-8","lg:text-2xl","font-medium","tracking-tight","text-secondary","mt-4","md:mt-6"],[1,"text-2xl"],[1,"col-span-12","sm:col-span-1","min-w-40"],[1,"flex","flex-col","mt--1"],[1,"font-semibold","mb-1"],[1,"flex","flex-col",3,"color","value","formControlName"],[1,"",3,"value"],[1,"col-span-12","md:col-span-3","mb-4","lg:ml-6"],[1,"fuse-mat-textarea","fuse-mat-no-subscript","w-full"],["matInput","","cdkTextareaAutosize","",3,"formControlName","cdkAutosizeMinRows"],[1,"col-span-12","md:col-span-2","md:pl-4","min-w-40"],["required","",3,"formControlName","compareWith"],[1,"col-span-12","md:col-span-2","md:pr-2","lg:ml-6"],["class","flex flex-col gt-xs:flex-row",4,"ngIf"],[1,"col-span-12","md:col-span-2","md:pr-4"],[1,"flex","flex-col","gt-sm:flex-row"],[1,"flex"],[1,"flex-auto"],["matInput","",3,"formControlName","placeholder"],[1,"col-span-6","md:col-span-2","pr-4","md:pt-6"],["mat-flat-button","","type","reset",1,"px-8",3,"color","disabled","click"],[1,"col-span-12","sm:col-span-12","mb-6"],["hideToggle","",3,"expanded","opened"],[1,"h-12","bg-gray-50","dark:bg-transparent"],[1,"text-lg","font-semibold"],[1,"mr-4"],["matExpansionPanelContent",""],[3,"idCliente"],[3,"value"],[1,"col-span-12","border-b"],[1,"col-span-4","md:col-span-5","mb-4",3,"dblclick"],[1,"text-lg","font-medium"],[1,"text-sm","text-secondary"],[1,"col-span-3","md:col-span-1"],[1,"col-span-2","md:col-span-2"],[1,"col-span-3","md:col-span-2"],[1,"col-span-1","text-center"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6",3,"click"],[1,"col-span-12","md:col-span-2","ml-6"],["autocomplete","off","matInput","","required","","matInput","",3,"formControlName","input"],["Pagonicial",""],[1,"col-span-12","md:col-span-2"],["autocomplete","off","matInput","","readonly","",3,"formControlName"],["autocomplete","off","matInput","",3,"formControlName"],[1,"col-span-12","md:col-span-1"],[1,"flex","flex-col","gt-xs:flex-row"],[1,"flex-auto","gt-xs:pr-3"],["matPrefix",""],[1,"flex-auto","gt-xs:pl-3"],["matInput","","matInput","",3,"formControlName","placeholder","input"],[1,""],["matInput","","readonly","",3,"formControlName","placeholder"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"fuse-alert",1)(2,"span",2),e._uU(3,"Venta guardada"),e.qZA(),e._uU(4," Venta "),e.TgZ(5,"b"),e._uU(6),e.qZA(),e._uU(7," registrada correctamente. "),e.qZA(),e.TgZ(8,"fuse-alert",1)(9,"span",2),e._uU(10,"Error en el guardado"),e.qZA(),e._uU(11),e.qZA(),e.TgZ(12,"div",3)(13,"div",4)(14,"div",5)(15,"div",6)(16,"div",7),e._UZ(17,"img",8),e.qZA(),e.TgZ(18,"div",9)(19,"div",10),e._uU(20,"Registro de ventas"),e.qZA(),e.TgZ(21,"span",11),e._UZ(22,"mat-icon",12),e.TgZ(23,"span"),e._uU(24),e.qZA()()(),e.TgZ(25,"div",9),e._uU(26," Printer status:"),e.TgZ(27,"strong"),e._uU(28),e.qZA(),e.TgZ(29,"div")(30,"button",13),e.NdJ("click",function(){return i.requestUsb()}),e._uU(31,"Connect to USB"),e.qZA()(),e.TgZ(32,"div")(33,"button",13),e.NdJ("click",function(){return i.print(null)}),e._uU(34," Print!"),e.qZA()()(),e.TgZ(35,"div",14)(36,"div",15)(37,"button",16),e._UZ(38,"mat-icon",12),e.qZA()(),e._UZ(39,"fuse-fullscreen",17)(40,"notifications")(41,"user"),e.qZA()()()(),e.TgZ(42,"div",18),e.YNc(43,st,8,1,"div",19),e.TgZ(44,"div",20)(45,"mat-form-field",21)(46,"mat-label"),e._uU(47,"Fecha de venta"),e.qZA(),e._UZ(48,"mat-icon",22)(49,"input",23)(50,"mat-datepicker-toggle",24)(51,"mat-datepicker",null,25),e.qZA()(),e.TgZ(53,"div",26)(54,"mat-form-field",21)(55,"mat-label"),e._uU(56,"Vendedor"),e.qZA(),e._UZ(57,"mat-icon",27),e.TgZ(58,"mat-select",28),e.YNc(59,lt,3,3,"ng-container",29),e.qZA()()(),e.TgZ(60,"div",30)(61,"p",31),e._uU(62," Folio "),e.qZA(),e.TgZ(63,"mat-form-field",32),e._UZ(64,"mat-icon",27)(65,"input",33),e.qZA()(),e.TgZ(66,"div",34)(67,"mat-form-field",35)(68,"mat-label"),e._uU(69,"Cliente"),e.qZA(),e._UZ(70,"mat-icon",27)(71,"input",36),e.TgZ(72,"mat-autocomplete",37,38),e.NdJ("optionSelected",function(o){return i.onSelectionChanged(o)}),e.YNc(74,ct,2,0,"mat-option",39),e.ALo(75,"async"),e.YNc(76,pt,2,5,"mat-option",40),e.ALo(77,"async"),e.qZA()()(),e.TgZ(78,"div",26)(79,"mat-form-field",41)(80,"mat-label"),e._uU(81,"Articulo"),e.qZA(),e._UZ(82,"mat-icon",27),e.TgZ(83,"input",42),e.NdJ("keydown.enter",function(){return i.agregarProduct()}),e.qZA(),e.TgZ(84,"mat-autocomplete",37,43),e.NdJ("optionSelected",function(o){return i.onSelectionChangedPr(o)}),e.YNc(86,dt,2,3,"mat-option",40),e.ALo(87,"async"),e.qZA()()(),e.TgZ(88,"div",44)(89,"mat-form-field",21)(90,"mat-label"),e._uU(91,"Cantidad"),e.qZA(),e.TgZ(92,"input",45),e.NdJ("ngModelChange",function(o){return i.cantidad=o}),e.qZA()()(),e.TgZ(93,"div",46)(94,"button",47),e.NdJ("click",function(){return i.agregarProduct()}),e.TgZ(95,"span",48)(96,"span"),e._uU(97,"Agregar"),e.qZA(),e._UZ(98,"mat-icon",49),e.qZA()()(),e.TgZ(99,"div",50)(100,"div",51)(101,"div",52)(102,"div",51)(103,"div",53)(104,"div",54)(105,"div",55),e._uU(106,"#"),e.qZA(),e._uU(107,"ARTICULO "),e.qZA()(),e.TgZ(108,"div",56)(109,"div",57)(110,"div",58),e._uU(111,"CANT."),e.qZA(),e.TgZ(112,"div",59),e._uU(113,"$ UNIT."),e.qZA(),e.TgZ(114,"div",59),e._uU(115,"DESCTO."),e.qZA(),e.TgZ(116,"div",59),e._uU(117,"TOTAL"),e.qZA(),e.TgZ(118,"div",60)(119,"span"),e._UZ(120,"mat-icon",12),e.qZA()()()()(),e.TgZ(121,"div",61,62),e.YNc(123,ut,26,14,"ng-container",29),e.qZA()(),e.TgZ(124,"div",63)(125,"div",57)(126,"div",64),e._uU(127," SUBTOTAL "),e.TgZ(128,"div",65),e._uU(129),e.ALo(130,"currency"),e.qZA()(),e.TgZ(131,"div",66),e._uU(132," DESCUENTO "),e.TgZ(133,"div",65),e._uU(134),e.ALo(135,"currency"),e.qZA()(),e.TgZ(136,"div",66),e._uU(137," IMPUESTOS "),e.TgZ(138,"div",65),e._uU(139),e.ALo(140,"currency"),e.qZA()(),e.TgZ(141,"div",67),e._uU(142," TOTAL "),e.TgZ(143,"div",68),e._uU(144),e.ALo(145,"currency"),e.qZA()()()()()(),e.TgZ(146,"div",69)(147,"div",70)(148,"span",71),e._uU(149,"Opciones de pago"),e.qZA(),e.TgZ(150,"mat-radio-group",72)(151,"mat-radio-button",73),e._uU(152," Contado "),e.qZA(),e.TgZ(153,"mat-radio-button",73),e._uU(154," Cr\xe9dito "),e.qZA()()()(),e.YNc(155,vt,37,15,"ng-container",39),e.TgZ(156,"div",74)(157,"mat-form-field",75)(158,"mat-label"),e._uU(159,"Observaciones"),e.qZA(),e._UZ(160,"textarea",76),e.qZA()(),e.TgZ(161,"div",77)(162,"mat-form-field",21)(163,"mat-label"),e._uU(164,"Forma de pago"),e.qZA(),e.TgZ(165,"mat-select",78),e.YNc(166,xt,3,3,"ng-container",29),e.qZA()()(),e.TgZ(167,"div",79)(168,"p",31),e._uU(169," Detalles de pago * "),e.qZA(),e.YNc(170,bt,5,2,"div",80),e.YNc(171,St,11,4,"div",80),e.qZA(),e.TgZ(172,"div",81)(173,"p",31),e._uU(174," Generaci\xf3n de ticket. "),e.qZA(),e.TgZ(175,"div",82)(176,"div",83)(177,"mat-form-field",84),e._UZ(178,"input",85)(179,"mat-icon",27),e.qZA()()()(),e.TgZ(180,"div",86)(181,"button",87),e.NdJ("click",function(){return i.vender()}),e._uU(182," Finalizar "),e.qZA()()()()()),2&t){const r=e.MAs(52),o=e.MAs(73),a=e.MAs(85),c=e.MAs(122);e.xp6(1),e.Q6J("appearance","soft")("dismissible",!0)("dismissed",!0)("name","ventaOk")("type","success"),e.xp6(5),e.Oqu(null==i.venta?null:i.venta.folio),e.xp6(2),e.Q6J("appearance","soft")("dismissible",!0)("dismissed",!0)("name","ventaNoOk")("type","warn"),e.xp6(3),e.hij(" ",i.mensajeWarn," "),e.xp6(6),e.Q6J("src",i.logoUrl,e.LSH),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:office-building"),e.xp6(2),e.hij(" ",null==i.sucursalOp?null:i.sucursalOp.sucursal,""),e.xp6(4),e.hij(" ",i.status,""),e.xp6(9),e.Q6J("routerLink",e.DdM(91,Ct))("matTooltip","Cerrar POS"),e.xp6(1),e.Q6J("svgIcon","arrow_back"),e.xp6(4),e.Q6J("formGroup",i.ventaForm),e.xp6(1),e.Q6J("ngIf",i.mostrarRegistroRapidoCte),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:calendar"),e.xp6(1),e.Q6J("matDatepicker",r)("formControlName","fecha")("placeholder","Fecha de venta"),e.xp6(1),e.Q6J("for",r),e.xp6(7),e.Q6J("svgIcon","heroicons_solid:user"),e.xp6(1),e.Q6J("formControlName","vendedor"),e.xp6(1),e.Q6J("ngForOf",i.vendedores),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:hashtag"),e.xp6(1),e.Q6J("formControlName","folio")("placeholder","Vacio para generacion automatica"),e.xp6(2),e.Q6J("floatLabel","always"),e.xp6(3),e.Q6J("svgIcon","heroicons_solid:search"),e.xp6(1),e.Q6J("formControl",i.clienteSel)("matAutocomplete",o)("placeholder",i.textoCliente),e.xp6(1),e.Q6J("displayWith",i.displayCl),e.xp6(2),e.Q6J("ngIf",e.lcZ(75,77,i.filteredCustomers).length<1),e.xp6(2),e.Q6J("ngForOf",e.lcZ(77,79,i.filteredCustomers)),e.xp6(3),e.Q6J("floatLabel","always"),e.xp6(3),e.Q6J("svgIcon","heroicons_solid:search"),e.xp6(1),e.Q6J("formControl",i.producto)("matAutocomplete",a)("placeholder",i.textoProducto),e.xp6(1),e.Q6J("displayWith",i.displayPr),e.xp6(2),e.Q6J("ngForOf",e.lcZ(87,81,i.filteredProds)),e.xp6(6),e.Q6J("ngModelOptions",e.DdM(92,yt))("ngModel",i.cantidad),e.xp6(2),e.Q6J("color","primary")("disabled",null==i.selectedProduct||null==i.selectedCustomer),e.xp6(4),e.Q6J("svgIcon","heroicons_solid:arrow-sm-right"),e.xp6(22),e.Q6J("svgIcon","heroicons_solid:trash"),e.xp6(1),e.Q6J("scrollTop",c.scrollHeight),e.xp6(2),e.Q6J("ngForOf",i.listaCompras),e.xp6(6),e.Oqu(e.lcZ(130,83,i.subtotal)),e.xp6(5),e.Oqu(e.lcZ(135,85,i.descuento)),e.xp6(5),e.Oqu(e.lcZ(140,87,i.impuestos)),e.xp6(5),e.Oqu(e.lcZ(145,89,i.total)),e.xp6(6),e.Q6J("color","primary")("value","CONTADO")("formControlName","tipo"),e.xp6(1),e.Q6J("value","CONTADO"),e.xp6(2),e.Q6J("value","CREDITO"),e.xp6(2),e.Q6J("ngIf","CREDITO"==i.ventaForm.get("tipo").value),e.xp6(5),e.Q6J("formControlName","observaciones")("cdkAutosizeMinRows",3),e.xp6(5),e.Q6J("formControlName","formaPago")("compareWith",i.compareFn),e.xp6(1),e.Q6J("ngForOf",i.formasPago),e.xp6(4),e.Q6J("ngIf","01"!==i.ventaForm.get("formaPago").value.claveSAT),e.xp6(1),e.Q6J("ngIf","01"===i.ventaForm.get("formaPago").value.claveSAT),e.xp6(7),e.Q6J("formControlName","email")("placeholder","Email Address"),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:mail"),e.xp6(2),e.Q6J("color","primary")("disabled",!i.ventaForm.valid)}},dependencies:[x.rH,m.sg,m.O5,M.eB,h.v_,h.$V,h.g4,h.nX,A.Hw,oe.IC,O.k0,F.x8,le.CK,I.ib,I.yz,I.yK,I.HS,J.Kd,it.W,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.On,l.oH,l.sg,l.u,Q.OY,Q.vy,E.Mq,E.hl,E.nW,D.VN,D.QJ,nt.M,rt.t,ot.A,C,m.Ov,m.H9],encapsulation:2,changeDetection:0});var Tt=s(7265),y=s(8531),It=s(7686),At=s(6308),Mt=s(8288),Zt=s(2287);function wt(n,t){1&n&&(e.TgZ(0,"div",15),e._UZ(1,"mat-progress-bar",16),e.qZA()),2&n&&(e.xp6(1),e.Q6J("mode","indeterminate"))}function Pt(n,t){if(1&n&&(e.ynx(0),e.TgZ(1,"mat-option",17),e._uU(2),e.qZA(),e.BQk()),2&n){const i=t.$implicit;e.xp6(1),e.Q6J("value",i),e.xp6(1),e.AsE(" ",i.sucursal," - ",i.tipoSucursal.tipoSucursal," ")}}const kt=function(){return["../../"]};class P{constructor(t,i,r,o,a,c){this._changeDetectorRef=t,this._fuseConfirmationService=i,this._formBuilder=r,this._inventarioService=o,this._router=a,this._activatedRoute=c,this.flashMessage=null,this.isLoading=!1,this.searchInputControl=new l.NI,this.sucursalControl=new l.NI,this.selectedProduct=null,this._unsubscribeAll=new L.x}ngOnInit(){this.selectedProductForm=this._formBuilder.group({id:[""],producto:[null],sucursal:[null],stock:["",l.kI.required],stockMinimo:["",l.kI.required],reservado:["",l.kI.required],precioVenta:[0],imagenes:[[]],currentImageIndex:[0],activo:[!1]}),this._inventarioService.branches$.pipe((0,b.R)(this._unsubscribeAll)).subscribe(t=>{this.branches=t,this.sucursalSeleccionada=t[0],this._changeDetectorRef.markForCheck()})}ngAfterViewInit(){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}showFlashMessage(t){this.flashMessage=t,this._changeDetectorRef.markForCheck(),setTimeout(()=>{this.flashMessage=null,this._changeDetectorRef.markForCheck()},3e3)}trackByFn(t,i){return i.id||t}openPOS(){this._inventarioService.sucursalSeleccionada=this.sucursalSeleccionada,this._router.navigate([".",this.sucursalSeleccionada.id],{relativeTo:this._activatedRoute})}}P.\u0275fac=function(t){return new(t||P)(e.Y36(e.sBO),e.Y36(Zt.R),e.Y36(l.qu),e.Y36(se.I),e.Y36(x.F0),e.Y36(x.gz))},P.\u0275cmp=e.Xpm({type:P,selectors:[["sucursal-sel"]],viewQuery:function(t,i){if(1&t&&(e.Gf(It.cl,5),e.Gf(At.YE,5)),2&t){let r;e.iGM(r=e.CRH())&&(i._paginator=r.first),e.iGM(r=e.CRH())&&(i._sort=r.first)}},decls:18,vars:8,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],["class","absolute inset-x-0 bottom-0",4,"ngIf"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mr-4"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["mat-flat-button","",1,"ml-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","items-center","justify-end"],["mat-stroked-button","","type","button",3,"routerLink"],[1,"absolute","inset-x-0","bottom-0"],[3,"mode"],[3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,wt,2,1,"div",2),e.TgZ(3,"div",3),e._uU(4,"Apertura POS "),e.qZA(),e.TgZ(5,"div",4)(6,"mat-form-field",5),e._UZ(7,"mat-icon",6),e.TgZ(8,"mat-select",7),e.NdJ("ngModelChange",function(o){return i.sucursalSeleccionada=o}),e.YNc(9,Pt,3,3,"ng-container",8),e.qZA()(),e.TgZ(10,"button",9),e.NdJ("click",function(){return i.openPOS()}),e._UZ(11,"mat-icon",10),e.TgZ(12,"span",11),e._uU(13,"Abrir POS"),e.qZA()()()(),e.TgZ(14,"div",12)(15,"div",13)(16,"button",14),e._uU(17," Cancelar "),e.qZA()()()()),2&t&&(e.xp6(2),e.Q6J("ngIf",i.isLoading),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:office-building"),e.xp6(1),e.Q6J("ngModel",i.sucursalSeleccionada),e.xp6(1),e.Q6J("ngForOf",i.branches),e.xp6(1),e.Q6J("color","primary"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:plus"),e.xp6(5),e.Q6J("routerLink",e.DdM(7,kt)))},dependencies:[x.rH,m.sg,m.O5,M.eB,h.v_,h.g4,A.Hw,V.eI,F.x8,le.CK,l.JJ,l.On],styles:[".inventory-grid{grid-template-columns:48px auto 40px}@media (min-width: 600px){.inventory-grid{grid-template-columns:48px auto 112px 72px}}@media (min-width: 960px){.inventory-grid{grid-template-columns:48px 112px auto 112px 72px}}@media (min-width: 1280px){.inventory-grid{grid-template-columns:48px 112px auto 112px 96px 96px 72px}}\n"],encapsulation:2,data:{animation:Mt.L},changeDetection:0});const Et=[{path:"",component:P,resolve:{sucursales:Tt.mr}},{path:":sucursal",component:w,resolve:{productos:y.Vh,clientes:y.d_,vendeores:y.DU,brands:y.Hx,formasPago:y.a7,rutas:y.rG}}];var Ot=s(4466);class T{}T.\u0275fac=function(t){return new(t||T)},T.\u0275mod=e.oAB({type:T}),T.\u0275inj=e.cJS({providers:[m.uU,m.Ts,m.H9],imports:[x.Bz.forChild(Et),m.ez,M.yu,h.wp,A.Ps,O.x4,V.jc,F.uw,I.To,he.SJ,ue.Wd,J.AA,Oe.V,G.fC,Ot.m,me.Nn,de.Zh,Q.Xo,g.Is,ke,E.FA,pe.Yd,D.D8,Ee.v,Ne.F,Re.z]})}}]);